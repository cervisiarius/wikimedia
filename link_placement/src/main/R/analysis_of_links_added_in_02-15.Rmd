---
title: "Analysis of added links"
author: "Bob West"
date: "07/01/2015"
output: html_document
---


```{r}
.default_par <- par(no.readonly=TRUE)

DATADIR <- sprintf('%s/wikimedia/trunk/data/link_placement/', Sys.getenv('HOME'))

data <- read.table(pipe(sprintf('gunzip -c %s/links_added_in_02-15_WITH-STATS.tsv.gz', DATADIR)),
                   header=TRUE, quote='', sep='\t')
data[,1] <- paste(data$src, data$tgt)
data <- data[,-2]
colnames(data)[1] <- 'cand'

# Currently the data is only accurate for the cases where both #paths_before and #paths_after is
# greater than 0; if only one of them is greater than 0, then both will appear as 0 (consequence
# of how Ashwin extracted the data).
# So here we can only analyze pairs that were active both before and after.
active <- data[data$num_paths_before > 0 & data$num_paths_after > 0,]

plot(active$num_paths_before, active$num_paths_after, log='xy', col='#00000005', pch=16)
cor(active$num_paths_before, active$num_paths_after, method='spearman')

plot(active$num_paths_before, active$num_clicks_after, log='xy', col='#00000005', pch=16)

plot(sort(active$num_clicks_after), (nrow(active):1)/nrow(active), log='xy', type='l')


plot(active$num_paths_before, active$num_clicks_after/active$num_paths_after, log='x', col='#00000005', pch=16)
lowess <- lowess(log(active$num_paths_before), log(active$num_clicks_after/active$num_paths_after))
lines(exp(lowess$x), exp(lowess$y), col='red')

groups <- cut(active$num_paths_before, c(1,10,100,1000,10000))
boxplot(active$num_clicks_after/active$num_paths_after ~ groups)

num_wiki_searches_before <- active$num_wiki_searches_302_before + active$num_wiki_searches_200_before
num_wiki_searches_after <- active$num_wiki_searches_302_after + active$num_wiki_searches_200_after

sgn <- sign(num_wiki_searches_after - num_wiki_searches_before)
barplot(tapply(sgn, sgn, length))

sgn <- sign(active$num_external_searches_after - active$num_external_searches_before)
barplot(tapply(sgn, sgn, length))

```

